<!DOCTYPE html>
<html>
  <canvas id='c' width='900' height='900'></canvas>
  <script src='webgl_utils.js'></script>
  <script id='vshader' type='x-shader'>
    attribute vec2 aVertexPosition;
    void main()
    {
      gl_Position = vec4(aVertexPosition, 0, 1);
    }
  </script>
  <script id='fshader' type='x-shader'>
    #ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
    #else
      precision mediump float;
    #endif
      precision mediump int;

    uniform vec2 uCanvasSize;

    vec4 calc(vec2 texCoord)
    {
      float x = 0.0;
      float y = 0.0;
      for(int iteration = 0; iteration < 100; iteration++)
      {
        float xTemp = x*x-y*y+texCoord.x;
        y = 2.0*x*y+texCoord.y;
        x = xTemp;
        if(x*x+y*y >= 8.0)
        {
          float d = float(iteration) / 20.0;
          return vec4(d,d,d,1);
        }
      }
      return vec4(0,0,0,1);
    }

    void main()
    {
      vec2 texCoord = (gl_FragCoord.xy/uCanvasSize.xy) * 2.0 - vec2(1.0,1.0);
      gl_FragColor = calc(texCoord);
    }
  </script>
  <script>
    var c = document.getElementById('c');
    var gl = c.getContext('experimental-webgl');

    var vertexPosBuffer = screenQuad();

    var vs = document.getElementById('vshader').textContent;
    var fs = document.getElementById('fshader').textContent;
    var program = createProgram(vs, fs);
    gl.useProgram(program);
    program.vertexPosAttrib = gl.getAttribLocation(program, 'aVertexPosition');
    program.canvasSizeUniform = gl.getUniformLocation(program, 'uCanvasSize');
    gl.enableVertexAttribArray(program.vertexPosAttrib);
    gl.vertexAttribPointer(program.vertexPosAttrib, vertexPosBuffer.itemSize, gl.FLOAT, false, 0, 0);
    gl.uniform2f(program.canvasSizeUniform, c.width, c.height);
    gl.drawArrays(gl.TRIANGLE_STRIP, 0, vertexPosBuffer.numItems);
  </script>
</html>
